## 时钟 ##
无论是单片机还是操作系统都离不开时钟的控制。

## 配置&&启动 ##
让硬件跑程序有两种方式：
1. 通过mdk软件来让单片机不断的循环执行程序
2. 通过操作系统

占用 flash 和 sram 

通过配置mdk加入官方的启动文件：SYSTEM 文件夹里面的代码，是 STM32F10x 系列的底层核心驱动函数，可以用在 STM32F10x 系列的各个
型号上面。
delay.c：控制系统的延时的功能；
*sys.c*:1.IO口的位带操作2.时钟控制3.休眠降低功耗4.下载&&烧写功能5.中断管理
usart.c（串行异步收发器）：串口的初始化和中断来接收数据

> 位带操作：stm32中，一个地址单元就是一个字节，即一个地址为8bit。即：我要 PORTA 的第七个 IO 口输出 1，则可以使用 PAout(6)=1就可以了，其实质是地址的偏移映射到IDR端口控制寄存器上面。

## 跑马灯 ##

概述：STM32 的 IO 口如何输出的。

STM32 的 IO 口可以由软件配置成如下 8 种模式：
输入：
1、 输入浮空
2、 输入上拉
3、 输入下拉
4、 模拟输入
输出：
5、 开漏输出
6、 推挽输出
端口复用：
7、 推挽式复用功能
8、 开漏复用功能

通过mdk内置的“逻辑分析仪”来进行软件仿真，查看输出波形。

## 按键输入 ##
通过读取端口寄存器IDR的内容太来确定IO口的状态，也可以通过位带操作直接控制-->通过按键来控制led的亮灭。

## 串口 ##
stm32最多可提供 5 路串口。
设置步骤：
1. 串口使能
2. 串口复位
3. 设置波特率
4. 串口控制实现功能
5. 数据的发送和接收
6. 串口的状态读取

## 外部中断 ##

STM32 的每个 IO口都可以作为中断输入。
设置步骤：
1. 初始化IO口作为输入
2. 开启 IO 口复用时钟，设置 IO 口与中断线的映射关系
3. 开启与该 IO 口相对的线上中断/事件，设置如何触发中断
4. 配置中断分组（NVIC），并使能中断。
5. 编写中断服务函数，中断后进行的操作

通过读取IO的状态设置优先级实现不同的按键来控制不同的灯来按下，可以同时按下。

## 看门狗 ##

作用：在程序跑飞的时候来复位系统。

独立看门狗：STM32 的独立看门狗由内部专门的 40Khz 低速时钟驱动，即使主时钟发生故障，它也仍然
有效。
窗口看门狗：窗口看门狗（WWDG）通常被用来监测由外部干扰或不可预见的逻辑条件造成的应用程序
背离正常的运行序列而产生的软件故障。

需要 2 个 IO 口，一个用来输入喂狗信号，另外一个用来指示程序是否重启。

要及时的对特定位写入数据，“喂狗”， 要不然就会到时程序复位。


## 定时器中断 ##

STM32 的通用定时器是一个通过可编程预分频器（PSC）驱动的 16 位自动装载计数器（CNT）
构成，每个通用的定时器都是独立的。
通用定时器共有5个，可以实现的功能有很多，可以控制分频系数从而控制外设的执行时间，也可以产生pwm波形。

## PWM  ##

脉宽调制:控制脉冲的宽度，就是占空比。

STM32 最多可以同时产生 30 路 PWM 输出。

配置寄存器：捕获/比较模式寄存器（ TIMx_CCMR1/2）、捕获/比较使能寄存器（TIMx_CCER）、捕获/比较寄存器（TIMx_CCR1~4） 以及刹车和死区寄存器（TIMx_BDTR）。
例如：实现通过 TIM1_CH1 输出PWM 来控制 DS0 的亮度

1. 开启 TIM1 时钟，配置 PA8 为复用输出
2. 设置 TIM1 的 ARR 和 PSC --> 控制pwd的总周期。
3. 设置 TIM1_CH1 的 PWM 模式及通道方向 --> 匹配控制，CCR1 的值小的时候， DS0 就暗， CCR1 值大的时候， DS0 就亮。
4. 使能 TIM1 的 CH1 输出，使能 TIM1
5. 设置 MOE 输出，使能 PWM 输出 (高级定时器设置)
6. 修改 TIM1_CCR1 来控制占空比 --> 修改 TIM1_CCR1 则可以控制 CH1 的输出占空比。继而控制 DS0 的亮度.

## 输入捕获  ##

输入捕获模式可以用来测量脉冲宽度或者测量频率

## USMART  ##

类似与ssh通过串口连接，调用在Flash中的函数来实时操作硬件外设。

## RTC内部时钟  ##
RTC 属于 STM32 内部资源，其配置也是通过软件设置好就可以了。不过 RTC 不能断电，否则数据就丢失了， 我们如果想让时间在断电后还可以继续走，那么必须确保开发板的电池有电（ALIENTEK MiniSTM32 开发板标配是有电池的）。

## 待机唤醒  ##

在系统或电源复位以后，微控制器处于运行状态。运行状态下的 HCLK 为 CPU 提供时钟，内核执行程序代码。当 CPU 不需继续运行时，可以利用多个低功耗模式来节省功耗，例如等待某个外部事件时。用户需要根据最低电源消耗，最快速启动时间和可用的唤醒源等条件，选定一个最佳的低功耗模式。 

## ADC 模拟数字转化器  ##

ADC转化有两个通道组，规则通道组：正在运行的程序，注入通道组：中断。

采集外部电压值并且显示出来。

## 内部温度传感器 ##

## DAC 数字模拟转化器 ##

实验效果：利用按键（或 USMART） 控制 STM32 内部 DAC 1 来输出电压，通过 ADC1的通道 1 采集 DAC 的输出电压，在 LCD 模块上面显示 ADC 获取到的电压值以及 DAC 的设定输出电压值等信息。


## IIC 通信 ##

IIC(Inter－Integrated Circuit)总线是一种由 PHILIPS 公司开发的两线式串行总线，用于连接
微控制器及其外围设备。它是由数据线 SDA 和时钟 SCL 构成的串行总线，可发送和接收数据。
在 CPU 与被控 IC 之间、 IC 与 IC 之间进行双向传送， 高速 IIC 总线一般可达 400kbps 以上。
I2C 总线在传送数据过程中共有三种类型信号， 它们分别是：开始信号、结束信号和应答
信号。
开始信号： SCL 为高电平时， SDA 由高电平向低电平跳变，开始传送数据。
结束信号： SCL 为高电平时， SDA 由低电平向高电平跳变，结束传送数据。
应答信号：接收数据的 IC 在接收到 8bit 数据后，向发送数据的 IC 发出特定的低电平脉冲，
表示已收到数据。 CPU 向受控单元发出一个信号后，等待受控单元发出一个应答信号， CPU 接
收到应答信号后，根据实际情况作出是否继续传递信号的判断。若未收到应答信号，由判断为
受控单元出现故障。
开始信号是必须的，结束信号和应答信号都可以不要。

## DMA ##

direct memory access 直接访问存储器
利用外设产生DMA请求
设置步骤：
1. 设置外设地址。
2. 设置存储器地址
3. 设置传输量地址
4. 配置通道x信息
5. 使能通道启动传输


## spi通信 ##

SPI，是一种高速的，全双工，同步的通信总线。
需要四条线来作为通信：
MISO 主设备数据输入，从设备数据输出。
MOSI 主设备数据输出，从设备数据输入。
SCLK 时钟信号，由主设备产生。
CS 从设备片选信号，由主设备控制。
SPI 主要特点有： 可以同时发出和接收串行数据； 可以当作主机或从机工作； 提供频率可
编程时钟；发送结束中断标志； 写冲突保护； 总线竞争保护等。

用spi对于外部的eeproom进行读写。


## flash ##

flash和eeproom的区别： flash是32的内部资源，内部ROM，而eeproom是外置安装的。


## 内存管理 ##

一直在疑惑如何在32上面申请内存，从而去制作链表之类的数据结构。
如果申请的内存过多就会导致内存不足的现象，所以如果申请大内存最后在调用完成后释放它。
RAM存档程序执行的中间变量用来辅助cpu往flash中写入数据来控制外设。
RAM内存可以进一步分为静态RAM（SRAM）和动态内存（DRAM）两大类，32用的是SRAM属于内存管理。

在没有系统的板子中：程序是一个死循环，所以要存到flash里面，RAM只起到中间变量的作用，如何利用内存？通过外设等外部操作的方式在将任务压倒内存中，由mcu执行。
在有系统时：程序是系统级别的，也是存在于flash之后，此时是通过系统的调用来规划任务，从而执行。


## IAP ##

IAP（In Application Programming）即在应用编程， IAP 是用户自己的程序在运行过程中对
User Flash 的部分区域进行烧写，目的是为了在产品发布后可以方便地通过预留的通信口对产
品中的固件程序进行更新升级。


## UCOSII ##

实时多任务操作系统内核，提高任务执行的并发性。


































## 	PID介绍引入 ##
比例、积分、微分（求导得出的曲线）
(非常好)[https://www.jianshu.com/p/e3845ee1e868]
Turn （转向）= Kp*error(误差) + Ki*integral(积分)+ Kd*derivative(导数)
和pwm控制，传感器来使用。

